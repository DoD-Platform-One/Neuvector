domain: dev.bigbang.mil

istio:
  enabled: false
  injection: "enabled"
  hardened:
    enabled: false
    customAuthorizationPolicies: []
    outboundTrafficPolicyMode: "REGISTRY_ONLY"
    monitoring:
      enabled: true
      namespaces:
        - monitoring
      principals:
        - cluster.local/ns/monitoring/sa/monitoring-grafana
        - cluster.local/ns/monitoring/sa/monitoring-monitoring-kube-alertmanager
        - cluster.local/ns/monitoring/sa/monitoring-monitoring-kube-operator
        - cluster.local/ns/monitoring/sa/monitoring-monitoring-kube-prometheus
        - cluster.local/ns/monitoring/sa/monitoring-monitoring-kube-state-metrics
        - cluster.local/ns/monitoring/sa/monitoring-monitoring-prometheus-node-exporter
    customServiceEntries: []
  neuvector:
    enabled: true
    annotations: {}
    labels: {}
    gateways:
      - istio-system/main
      #- istio-gateway/public-ingressgateway
    hosts:
      - neuvector.{{ .Values.domain }}
  # -- Default neuvector peer authentication
  mtls:
    # -- STRICT = Allow only mutual TLS traffic,
    # PERMISSIVE = Allow both plain text and mutual TLS traffic
    mode: STRICT

networkPolicies:
  enabled: false
  ingressLabels:
    app: public-ingressgateway
    istio: ingressgateway
  istioNamespaceSelector:
    ingress: istio-gateway
    egress: istio-gateway
  controlPlaneCidr: 0.0.0.0/0
  additionalPolicies: []

monitoring:
  enabled: false
  namespace: monitoring

# Bigbang helm test values default disabled
bbtests:
  enabled: false
  cypress:
    artifacts: true
    envs:
      cypress_url: "http://neuvector-service-webui.{{ .Release.Namespace }}.svc.cluster.local:8443"
    resources:
      requests:
        cpu: "2"
        memory: "4Gi"
      limits:
        cpu: "2"
        memory: "4Gi"
  scripts:
    envs:
      URL: "http://neuvector-service-webui.{{ .Release.Namespace }}.svc.cluster.local:8443"

global: # required for rancher authentication (https://<Rancher_URL>/)
    imagePullSecrets:
    images:
      neuvector_csp_pod:
        tag: latest
        image: neuvector-billing-azure-by-suse-llc
        registry: registry.suse.de/suse/sle-15-sp5/update/pubclouds/images
        imagePullPolicy: Always
      controller:
        tag: 5.4.3
        image: controller
        registry: registry1.dso.mil/ironbank/neuvector/neuvector
      manager:
        tag: 5.4.3
        image: manager
        registry: registry1.dso.mil/ironbank/neuvector/neuvector
      enforcer:
        tag: 5.4.3
        image: enforcer
        registry: registry1.dso.mil/ironbank/neuvector/neuvector

# -- Values to pass to [the upstream NeuVector core subchart](https://github.com/neuvector/neuvector-helm/blob/master/charts/core/values.yaml)
# @default -- Upstream chart values for Neuvector core

upstream:
  nameOverride: neuvector
  fullnameOverride: neuvector-neuvector
  bootstrapPassword: changeme$! # neuvector enforces a mandatory password change on first login

  openshift: false
  registry: registry1.dso.mil
  tag: 5.4.6
  imagePullSecrets: private-registry
  crdwebhook:
    enabled: false

  controller:
    # If false, controller will not be installed
    enabled: true
    image:
      repository: ironbank/neuvector/neuvector/controller
      imagePullPolicy: Always
    podAnnotations:
      traffic.sidecar.istio.io/excludeInboundPorts: "18500"
    containerSecurityContext:
      privileged: true
      runAsUser: 1000
      runAsNonRoot: true
      capabilities:
        drop:
          - ALL
    certupgrader:
      imagePullPolicy: Always
      podAnnotations:
        traffic.sidecar.istio.io/excludeInboundPorts: "18500"
        traffic.sidecar.istio.io/excludeOutboundPorts: "18500"
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
      containerSecurityContext:
        runAsUser: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        capabilities:
          drop:
            - ALL
    apisvc:
      type: ClusterIP
      annotations: {}
      nodePort: null
    prime:
      enabled: false
      image:
        repository: neuvector/compliance-config
        tag: 5.4.6

  enforcer:
    enabled: true
    image:
      repository: ironbank/neuvector/neuvector/enforcer
      imagePullPolicy: Always
    podAnnotations:
      traffic.sidecar.istio.io/excludeInboundPorts: "18500"
    containerSecurityContext:
      privileged: true
      runAsGroup: 1000
      capabilities:
        drop:
          - ALL

  manager:
    enabled: true
    image:
      repository: ironbank/neuvector/neuvector/manager
      imagePullPolicy: Always
    env:
      ssl: false
    podAnnotations:
      traffic.sidecar.istio.io/excludeInboundPorts: "18500"
    containerSecurityContext:
      runAsUser: 1000
      runAsGroup: 1000
      runAsNonRoot: true
      capabilities:
        drop:
          - ALL
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000

  cve:
    adapter:
      enabled: false
      image:
        repository: neuvector/registry-adapter
        tag: 0.1.9
        traffic.sidecar.istio.io/excludeInboundPorts: "18500"
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        runAsNonRoot: true
    updater:
      enabled: true
      secure: false
      cacert: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      image:
        registry: "registry1.dso.mil"
        repository: ironbank/big-bang/base
        imagePullPolicy: Always
        tag: 2.1.0
      podAnnotations:
        traffic.sidecar.istio.io/excludeInboundPorts: "18500"
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        runAsNonRoot: true
      containerSecurityContext:
        runAsUser: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        capabilities:
          drop:
            - ALL
    scanner:
      enabled: true
      image:
        repository: ironbank/neuvector/neuvector/scanner
        imagePullPolicy: Always
        tag: "6"
      podAnnotations:
        traffic.sidecar.istio.io/excludeInboundPorts: "18500"
      runAsUser:
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        runAsNonRoot: true
      containerSecurityContext:
        runAsUser: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        capabilities:
          drop:
            - ALL

# Monitor subchart:
# From https://github.com/neuvector/neuvector-helm/blob/master/charts/monitor/values.yaml
monitor:
  imagePullSecrets: private-registry
  install: false
  serviceAccount: default
  registry: registry1.dso.mil

  exporter:
    enabled: false
    serviceMonitor:
      enabled: false
    svc:
      enabled: false
    image:
      repository: ironbank/neuvector/neuvector/prometheus-exporter
      tag: 1-1.0.0
      imagePullPolicy: Always
    containerSecurityContext:
      runAsUser: 1001
      runAsGroup: 1001
      capabilities:
        drop:
          - ALL
